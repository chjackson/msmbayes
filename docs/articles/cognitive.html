<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Code for using the msmbayes package for semi-Markov modelling in an application to cognitive function • msmbayes</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Code for using the msmbayes package for semi-Markov modelling in an application to cognitive function">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msmbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examples.html">Examples of using msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/misclass.html">Misclassification multi-state models in msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/semimarkov.html">Semi-Markov models with msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/nphase.html">Advanced phase-type models in msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/cognitive.html">Code for using the msmbayes package for semi-Markov modelling in an application to cognitive function</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/msmbayes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Code for using the msmbayes package for semi-Markov modelling in an application to cognitive function</h1>
                        <h4 data-toc-skip class="author">Christopher
Jackson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msmbayes/blob/HEAD/vignettes/articles/cognitive.Rmd" class="external-link"><code>vignettes/articles/cognitive.Rmd</code></a></small>
      <div class="d-none name"><code>cognitive.Rmd</code></div>
    </div>

    
    
<p>This file gives the code used for the analysis of the cognitive
function data in Section 7 of the paper “Stable and practical
semi-Markov modelling of intermittently-observed data” (Jackson).</p>
<p>It is intended to show that the methodology in the paper and the
<code>msmbayes</code> package can be easily used in practice. Though for
actually learning the package, it is better to start with other
documentation given on the <a href="https://chjackson.github.io/msmbayes">package site</a>, in
particular the Examples vignette and function references.</p>
<p>Since the original ELSA dataset cannot be redistributed, here we
provide a simulated dataset with the same structure and size. The code
used for the analysis is the same as in the paper, just with different
data. Therefore the code can be run, but the results will be
different.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msmbayes" class="external-link">msmbayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msm" class="external-link">msm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"elsa_priors.R"</span><span class="op">)</span></span>
<span><span class="va">Q5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">save_files</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># for local use</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="va">wd</span> <span class="op">&lt;-</span> <span class="st">"../elsa/fakedata"</span></span>
<span> <span class="va">mbmodc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"mbmodc.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">mbmodscw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"mbmodscg.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">mbmodscg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"mbmodscw.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulated-data">Simulated data<a class="anchor" aria-label="anchor" href="#simulated-data"></a>
</h2>
<p>A simulated dataset is loaded here, which was produced by simulating
state outcomes from a Markov model fitted to the original ELSA data. The
same number of individuals and observation times are simulated as in the
original data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elsa1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"elsa_fakedata.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-data-summaries">Basic data summaries<a class="anchor" aria-label="anchor" href="#basic-data-summaries"></a>
</h2>
<p>Calculate the number of observed transitions over an interval between
observations, by from-state and to-state. Overall and split by
covariates. Note a small number of deaths from each state.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/statetable.html">statetable</a></span><span class="op">(</span>state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>, data<span class="op">=</span><span class="va">elsa1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">#&gt;   fromstate timelag                     `1`   `2`   `3`   `4`   `5`</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 [0.000182005853254452,11]   953   680   238    39    61</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 [0.000182005853254452,11]   190   558   342    37    20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         3 [0.000182005853254452,11]    48   220   445   108    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         4 [0.000182005853254452,11]     4    17    64   135     7</span></span>
<span><span class="fu"><a href="../reference/statetable.html">statetable</a></span><span class="op">(</span>state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>, </span>
<span>           covariates <span class="op">=</span> <span class="st">"gender"</span>, data<span class="op">=</span><span class="va">elsa1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 8</span></span></span>
<span><span class="co">#&gt;   fromstate timelag                   gender   `1`   `2`   `3`   `4`   `5`</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 [0.000182005853254452,11] man      377   291   107    20    27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         1 [0.000182005853254452,11] woman    576   389   131    19    34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         2 [0.000182005853254452,11] man       73   258   167    11     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         2 [0.000182005853254452,11] woman    117   300   175    26    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         3 [0.000182005853254452,11] man       15   111   237    47     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>         3 [0.000182005853254452,11] woman     33   109   208    61     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>         4 [0.000182005853254452,11] man        4     6    29    50     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>         4 [0.000182005853254452,11] woman      0    11    35    85     4</span></span>
<span><span class="fu"><a href="../reference/statetable.html">statetable</a></span><span class="op">(</span>state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>, </span>
<span>           covariates <span class="op">=</span> <span class="st">"age10"</span>, data<span class="op">=</span><span class="va">elsa1000</span> <span class="op">|&gt;</span> </span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age10<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">agey</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">60</span>,<span class="fl">70</span>,<span class="fl">80</span>,<span class="fl">110</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`5`</span><span class="op">)</span><span class="op">)</span> <span class="co"># deaths by age group </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   age10        n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (0,60]      28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> (60,70]     40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> (70,80]     21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> (80,110]     9</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="markov-models-in-msmbayes">Markov models in msmbayes<a class="anchor" aria-label="anchor" href="#markov-models-in-msmbayes"></a>
</h2>
<p>Start with the simplest model with no covariates and default priors,
as a sense check. Looking at just the transition intensities
(<code>q</code>), and mean sojourn times (<code>mst</code>) the
estimates do not look extreme or uncertain, but this is misleading -
when converted to a time scale, the expected times to the death state 5
(without competing risks) are implausibly large and uncertain.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mbmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">elsa1000</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>,</span>
<span>                  Q<span class="op">=</span><span class="va">Q5</span>, deathexact<span class="op">=</span><span class="cn">TRUE</span>, fit_method<span class="op">=</span><span class="st">"optimize"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbmod</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 7</span></span></span>
<span><span class="co">#&gt;    name   from    to        posterior    mode prior_string                prior</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> q         1     2  0.4050 <span style="color: #949494;">± 0.0171</span> 0.404   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> q         1     5  0.0185 <span style="color: #949494;">± 0.0030</span> 0.018<span style="text-decoration: underline;">2</span>  0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> q         2     1  0.2018 <span style="color: #949494;">± 0.0154</span> 0.201   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> q         2     3  0.3457 <span style="color: #949494;">± 0.0181</span> 0.345   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> q         2     5  0.0074 <span style="color: #949494;">± 0.0029</span> 0.006<span style="text-decoration: underline;">92</span> 0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> q         3     2  0.3226 <span style="color: #949494;">± 0.0232</span> 0.321   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> q         3     4  0.1260 <span style="color: #949494;">± 0.0106</span> 0.125   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> q         3     5  0.0059 <span style="color: #949494;">± 0.0029</span> 0.005<span style="text-decoration: underline;">25</span> 0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> q         4     3  0.2667 <span style="color: #949494;">± 0.0311</span> 0.265   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> q         4     5  0.0182 <span style="color: #949494;">± 0.0071</span> 0.017<span style="text-decoration: underline;">1</span>  0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> mst       1    <span style="color: #BB0000;">NA</span>  2.3653 <span style="color: #949494;">± 0.0970</span> 2.37    3.7 (0.073, 186)    26.11 <span style="color: #949494;">± 118.8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> mst       2    <span style="color: #BB0000;">NA</span>  1.8052 <span style="color: #949494;">± 0.0761</span> 1.81    2.5 (0.049, 124)    17.41 <span style="color: #949494;">± 79.2</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> mst       3    <span style="color: #BB0000;">NA</span>  2.2074 <span style="color: #949494;">± 0.1250</span> 2.21    2.5 (0.049, 124)    17.41 <span style="color: #949494;">± 79.2</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> mst       4    <span style="color: #BB0000;">NA</span>  3.5532 <span style="color: #949494;">± 0.3949</span> 3.55    3.7 (0.073, 186)    26.11 <span style="color: #949494;">± 118.8</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbmod</span>, pars<span class="op">=</span><span class="st">"time"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">#&gt;    name   from    to       posterior   mode prior_string              prior</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> time      1     2    2.5 <span style="color: #949494;">± 0.10</span>     2.47 7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> time      1     5   55.6 <span style="color: #949494;">± 8.87</span>    54.8  7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> time      2     1    5.0 <span style="color: #949494;">± 0.38</span>     4.97 7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> time      2     3    2.9 <span style="color: #949494;">± 0.15</span>     2.90 7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> time      2     5  155.0 <span style="color: #949494;">± 59.08</span>  144.   7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> time      3     2    3.1 <span style="color: #949494;">± 0.22</span>     3.11 7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> time      3     4    8.0 <span style="color: #949494;">± 0.67</span>     7.97 7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> time      3     5  213.3 <span style="color: #949494;">± 105.62</span> 190.   7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> time      4     3    3.8 <span style="color: #949494;">± 0.44</span>     3.78 7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> time      4     5   63.4 <span style="color: #949494;">± 25.13</span>   58.5  7.39 (0.1468, 371.9)   52 <span style="color: #949494;">± 238</span></span></span></code></pre></div>
<p>Since there is very little information in this dataset about death,
we obtain strong priors on the death rates, and effect of age and sex on
these, from national mortality statistics. Other effects are given
weakly informative priors: a log-normal(0, 1) distribution supports
hazard ratios up to around <code>exp(2) = 7</code>, which we suppose
would be surprising in the context of demographic effects on the risk of
cognitive decline. The priors are stored in the file
<code>elsa_priors.R</code>, and code used to derive them is in
Supplementary Appendix 4 of the paper.</p>
<p>Now include the covariates in the model, still with a Markov model.
These are age-sex interaction and level of education, modifying all
transition rates differently.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mbmodc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">elsa1000</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>,</span>
<span>                   Q<span class="op">=</span><span class="va">Q5</span>, deathexact<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                   covariates <span class="op">=</span>  <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                   priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">logq_priors</span>, <span class="va">loghr_priors</span><span class="op">)</span>, <span class="co"># init = list(ini),</span></span>
<span>                   fit_method<span class="op">=</span><span class="st">"optimize"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mbmodc</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"mbmodc.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Standard maximum likelihood estimation in <code>msm</code> appears to
converge, even without any constraints on the parameters, but some
confidence intervals for hazard ratios are implausibly wide.
<code>msmbayes</code> allows use of informative priors to stabilise
computation and support weak data with background information.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msmmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://chjackson.github.io/msm/reference/msm.html" class="external-link">msm</a></span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">agey</span>, subject<span class="op">=</span><span class="va">idauniq</span>, data<span class="op">=</span><span class="va">elsa1000</span>, </span>
<span>              qmatrix<span class="op">=</span><span class="va">Q5</span>, deathexact<span class="op">=</span><span class="cn">TRUE</span>, gen.inits<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>              covariates <span class="op">=</span>  <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>, </span>
<span>              control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fnscale<span class="op">=</span><span class="fl">4000</span>,maxit<span class="op">=</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://chjackson.github.io/msm/reference/hazard.msm.html" class="external-link">hazard.msm</a></span><span class="op">(</span><span class="va">msmmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; $genderwoman</span></span>
<span><span class="co">#&gt;                          HR            L            U</span></span>
<span><span class="co">#&gt; State 1 - State 2 0.9603818 7.090881e-01 1.300731e+00</span></span>
<span><span class="co">#&gt; State 1 - State 5 0.6490433 2.223327e-01 1.894715e+00</span></span>
<span><span class="co">#&gt; State 2 - State 1 1.2967242 6.669284e-01 2.521251e+00</span></span>
<span><span class="co">#&gt; State 2 - State 3 1.1585799 7.733754e-01 1.735648e+00</span></span>
<span><span class="co">#&gt; State 2 - State 5 2.8954462 1.504238e-01 5.573327e+01</span></span>
<span><span class="co">#&gt; State 3 - State 2 1.4126210 7.502159e-01 2.659898e+00</span></span>
<span><span class="co">#&gt; State 3 - State 4 1.6064021 7.470389e-01 3.454342e+00</span></span>
<span><span class="co">#&gt; State 3 - State 5 0.9840856 8.375991e-08 1.156191e+07</span></span>
<span><span class="co">#&gt; State 4 - State 3 1.0412543 3.585527e-01 3.023852e+00</span></span>
<span><span class="co">#&gt; State 4 - State 5 2.0375952 1.486375e-01 2.793235e+01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $y5010</span></span>
<span><span class="co">#&gt;                          HR         L         U</span></span>
<span><span class="co">#&gt; State 1 - State 2 0.9919275 0.8704663  1.130337</span></span>
<span><span class="co">#&gt; State 1 - State 5 0.9523135 0.6099833  1.486764</span></span>
<span><span class="co">#&gt; State 2 - State 1 0.9481615 0.7189083  1.250521</span></span>
<span><span class="co">#&gt; State 2 - State 3 1.1828684 0.9962667  1.404421</span></span>
<span><span class="co">#&gt; State 2 - State 5 1.2446084 0.4689087  3.303522</span></span>
<span><span class="co">#&gt; State 3 - State 2 1.2617222 0.9840197  1.617796</span></span>
<span><span class="co">#&gt; State 3 - State 4 0.8786238 0.6470422  1.193090</span></span>
<span><span class="co">#&gt; State 3 - State 5 3.3322781 0.2204045 50.380452</span></span>
<span><span class="co">#&gt; State 4 - State 3 0.7419514 0.4914210  1.120204</span></span>
<span><span class="co">#&gt; State 4 - State 5 0.6435016 0.2044546  2.025361</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $raeducluppersec</span></span>
<span><span class="co">#&gt;                          HR          L           U</span></span>
<span><span class="co">#&gt; State 1 - State 2 1.0349711 0.85487983    1.253001</span></span>
<span><span class="co">#&gt; State 1 - State 5 1.3954669 0.65206990    2.986379</span></span>
<span><span class="co">#&gt; State 2 - State 1 1.0707526 0.76599105    1.496768</span></span>
<span><span class="co">#&gt; State 2 - State 3 1.1060680 0.86665113    1.411625</span></span>
<span><span class="co">#&gt; State 2 - State 5 5.4246401 0.01726260 1704.651578</span></span>
<span><span class="co">#&gt; State 3 - State 2 0.9513119 0.67022597    1.350282</span></span>
<span><span class="co">#&gt; State 3 - State 4 1.2107354 0.79214271    1.850525</span></span>
<span><span class="co">#&gt; State 3 - State 5 1.2663330 0.01028868  155.860486</span></span>
<span><span class="co">#&gt; State 4 - State 3 0.9649467 0.53140143    1.752201</span></span>
<span><span class="co">#&gt; State 4 - State 5 0.6182428 0.13738921    2.782053</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $raeducltertiary</span></span>
<span><span class="co">#&gt;                            HR            L            U</span></span>
<span><span class="co">#&gt; State 1 - State 2 0.997141002 7.811159e-01    1.2729100</span></span>
<span><span class="co">#&gt; State 1 - State 5 1.247979897 4.314819e-01    3.6095457</span></span>
<span><span class="co">#&gt; State 2 - State 1 0.885078025 5.649087e-01    1.3867076</span></span>
<span><span class="co">#&gt; State 2 - State 3 1.033308440 7.602864e-01    1.4043738</span></span>
<span><span class="co">#&gt; State 2 - State 5 6.590408548 1.625101e-02 2672.6630883</span></span>
<span><span class="co">#&gt; State 3 - State 2 0.968283667 6.268514e-01    1.4956867</span></span>
<span><span class="co">#&gt; State 3 - State 4 0.856040385 5.069047e-01    1.4456467</span></span>
<span><span class="co">#&gt; State 3 - State 5 4.206708439 6.924609e-02  255.5580385</span></span>
<span><span class="co">#&gt; State 4 - State 3 0.444456031 2.056360e-01    0.9606353</span></span>
<span><span class="co">#&gt; State 4 - State 5 0.009210946 1.001644e-06   84.7022825</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`genderwoman:y5010`</span></span>
<span><span class="co">#&gt;                          HR           L          U</span></span>
<span><span class="co">#&gt; State 1 - State 2 0.9789217 0.824762202   1.161896</span></span>
<span><span class="co">#&gt; State 1 - State 5 1.2412095 0.674632911   2.283614</span></span>
<span><span class="co">#&gt; State 2 - State 1 1.0057234 0.713281660   1.418065</span></span>
<span><span class="co">#&gt; State 2 - State 3 0.8666753 0.693145917   1.083648</span></span>
<span><span class="co">#&gt; State 2 - State 5 0.5585449 0.081260720   3.839154</span></span>
<span><span class="co">#&gt; State 3 - State 2 0.8622604 0.633350876   1.173904</span></span>
<span><span class="co">#&gt; State 3 - State 4 0.8567347 0.584937871   1.254825</span></span>
<span><span class="co">#&gt; State 3 - State 5 0.8518272 0.005600282 129.566616</span></span>
<span><span class="co">#&gt; State 4 - State 3 0.8087406 0.481275351   1.359017</span></span>
<span><span class="co">#&gt; State 4 - State 5 0.5060219 0.103138691   2.482659</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="semi-markov-models-in-msmbayes">Semi-Markov models in msmbayes<a class="anchor" aria-label="anchor" href="#semi-markov-models-in-msmbayes"></a>
</h2>
<p>Gamma phase-type sojourn distribution, fitted using optimization to
find the posterior mode, followed by Laplace approximation. This may
take at least 20 minutes to run.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mbmodscg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">elsa1000</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>,</span>
<span>                    Q<span class="op">=</span><span class="va">Q5</span>, deathexact<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                    covariates <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span></span>
<span>                    <span class="op">)</span>,</span>
<span>                    pastates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>, panphase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span>, pafamily<span class="op">=</span><span class="st">"gamma"</span>,</span>
<span>                    priors <span class="op">=</span> <span class="fu">smm_priors</span><span class="op">(</span><span class="st">"gamma"</span><span class="op">)</span>, </span>
<span>                    fit_method<span class="op">=</span><span class="st">"optimize"</span>, verbose<span class="op">=</span><span class="cn">TRUE</span></span>
<span>                    <span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mbmodscg</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"mbmodscg.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Weibull phase-type sojourn distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span> </span>
<span><span class="va">mbmodscw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">elsa1000</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"agey"</span>, subject<span class="op">=</span><span class="st">"idauniq"</span>,</span>
<span>                    Q<span class="op">=</span><span class="va">Q5</span>, deathexact<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                    covariates <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span>,</span>
<span>                                        <span class="fu"><a href="../reference/rrnextdoc.html">rrnext</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span><span class="op">*</span><span class="va">y5010</span> <span class="op">+</span> <span class="va">raeducl</span></span>
<span>                    <span class="op">)</span>,</span>
<span>                    pastates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>, panphase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span>, pafamily<span class="op">=</span><span class="st">"weibull"</span>,</span>
<span>                    priors <span class="op">=</span> <span class="fu">smm_priors</span><span class="op">(</span><span class="st">"weibull"</span><span class="op">)</span>, </span>
<span>                    fit_method<span class="op">=</span><span class="st">"optimize"</span>, verbose<span class="op">=</span><span class="cn">TRUE</span></span>
<span>                    <span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mbmodscw</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"mbmodscw.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span><span class="va">mbmodscw</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"shape"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Dropping 'draws_df' class as required metadata was removed.</span></span></code></pre></div>
<p><img src="cognitive_files/figure-html/mbmodscw-1.png" width="700"></p>
<div class="section level3">
<h3 id="likelihood-based-model-comparison">Likelihood-based model comparison<a class="anchor" aria-label="anchor" href="#likelihood-based-model-comparison"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"The maximised log posterior is %s for the Markov model, %s for the Gamma semi-Markov model and %s for the Weibull semi-Markov model."</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/loglik.html">loglik</a></span><span class="op">(</span><span class="va">mbmodc</span><span class="op">)</span><span class="op">$</span><span class="va">mode</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/loglik.html">loglik</a></span><span class="op">(</span><span class="va">mbmodscg</span><span class="op">)</span><span class="op">$</span><span class="va">mode</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/loglik.html">loglik</a></span><span class="op">(</span><span class="va">mbmodscw</span><span class="op">)</span><span class="op">$</span><span class="va">mode</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The maximised log posterior is -4941 for the Markov model, -4986 for the Gamma semi-Markov model and -4959 for the Weibull semi-Markov model."</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="table-of-basic-parameter-estimates">Table of basic parameter estimates<a class="anchor" aria-label="anchor" href="#table-of-basic-parameter-estimates"></a>
</h3>
<p>Sojourn times, next-state probabilities and shape parameters, here in
LaTeX form to include in a paper.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_to_ttype</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">{</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">to</span><span class="op">==</span><span class="fl">5</span>, <span class="st">"Death"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">from</span> <span class="op">&lt;</span> <span class="va">to</span>, <span class="st">"Progression"</span>, <span class="st">"Recovery"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pn_markov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnext.html">pnext</a></span><span class="op">(</span><span class="va">mbmodc</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span>, <span class="va">posterior</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ttype <span class="op">=</span> <span class="fu">trans_to_ttype</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"from"</span><span class="op">)</span>, values_from<span class="op">=</span><span class="st">"posterior"</span>, names_from<span class="op">=</span><span class="st">"ttype"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>state<span class="op">=</span><span class="va">from</span>, <span class="va">`Progression`</span>,<span class="va">`Recovery`</span>,<span class="va">`Death`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mst <span class="op">=</span> <span class="fu"><a href="../reference/mean_sojourn.html">mean_sojourn</a></span><span class="op">(</span><span class="va">mbmodc</span><span class="op">)</span><span class="op">$</span><span class="va">posterior</span>,</span>
<span>         model <span class="op">=</span> <span class="st">"Markov"</span>,</span>
<span>         shape <span class="op">=</span> <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar.html" class="external-link">rvar</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">state</span>, <span class="va">mst</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pn_semi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnext.html">pnext</a></span><span class="op">(</span><span class="va">mbmodscw</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span>, <span class="va">posterior</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ttype <span class="op">=</span> <span class="fu">trans_to_ttype</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"from"</span><span class="op">)</span>, values_from<span class="op">=</span><span class="st">"posterior"</span>, names_from<span class="op">=</span><span class="st">"ttype"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>state<span class="op">=</span><span class="va">from</span>, <span class="va">`Progression`</span>,<span class="va">`Recovery`</span>,<span class="va">`Death`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mst <span class="op">=</span> <span class="fu"><a href="../reference/mean_sojourn.html">mean_sojourn</a></span><span class="op">(</span><span class="va">mbmodscw</span><span class="op">)</span><span class="op">$</span><span class="va">posterior</span>,</span>
<span>         model <span class="op">=</span> <span class="st">"Semi-Markov"</span>,</span>
<span>         shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbmodscw</span>, pars<span class="op">=</span><span class="st">"shape"</span><span class="op">)</span><span class="op">$</span><span class="va">posterior</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">state</span>, <span class="va">mst</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rvar_to_ci</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">summf</span> <span class="op">&lt;-</span> <span class="va">summ</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"50%"</span>,<span class="st">"2.5%"</span>,<span class="st">"97.5%"</span><span class="op">)</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>,<span class="fl">2</span><span class="op">)</span>,nsmall<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">summ</span><span class="op">[[</span><span class="st">"50%"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">""</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s \\newline {\\footnotesize (%s, %s)}"</span>, <span class="va">summf</span><span class="op">[[</span><span class="st">"50%"</span><span class="op">]</span><span class="op">]</span>, <span class="va">summf</span><span class="op">[[</span><span class="st">"2.5%"</span><span class="op">]</span><span class="op">]</span>, <span class="va">summf</span><span class="op">[[</span><span class="st">"97.5%"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://gt.rstudio.com/reference/latex.html" class="external-link">latex</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pn_markov</span>, <span class="va">pn_semi</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">model</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">mst</span><span class="op">:</span><span class="va">shape</span>, <span class="va">rvar_to_ci</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">tab</span>, sep<span class="op">=</span><span class="st">"  &amp;  "</span>, eol<span class="op">=</span><span class="st">"\\\\\n"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; state  &amp;  mst  &amp;  Progression  &amp;  Recovery  &amp;  Death  &amp;  shape\\</span></span>
<span><span class="co">#&gt; 1  &amp;  3.04 \newline {\footnotesize (2.39, 3.87)}  &amp;  0.98 \newline {\footnotesize (0.97, 0.99)}  &amp;    &amp;  0.02 \newline {\footnotesize (0.01, 0.03)}  &amp;  \\</span></span>
<span><span class="co">#&gt; 2  &amp;  2.47 \newline {\footnotesize (1.84, 3.31)}  &amp;  0.66 \newline {\footnotesize (0.51, 0.78)}  &amp;  0.33 \newline {\footnotesize (0.21, 0.49)}  &amp;  0.00 \newline {\footnotesize (0.00, 0.01)}  &amp;  \\</span></span>
<span><span class="co">#&gt; 3  &amp;  2.99 \newline {\footnotesize (1.91, 4.54)}  &amp;  0.35 \newline {\footnotesize (0.19, 0.56)}  &amp;  0.64 \newline {\footnotesize (0.43, 0.81)}  &amp;  0.01 \newline {\footnotesize (0.00, 0.01)}  &amp;  \\</span></span>
<span><span class="co">#&gt; 4  &amp;  1.94 \newline {\footnotesize (0.76, 4.73)}  &amp;    &amp;  0.99 \newline {\footnotesize (0.98, 1.00)}  &amp;  0.01 \newline {\footnotesize (0.00, 0.02)}  &amp;  \\</span></span>
<span><span class="co">#&gt; 1  &amp;  2.46 \newline {\footnotesize (1.94, 3.22)}  &amp;  0.96 \newline {\footnotesize (0.91, 0.98)}  &amp;    &amp;  0.04 \newline {\footnotesize (0.02, 0.09)}  &amp;  0.96 \newline {\footnotesize (0.88, 1.04)}\\</span></span>
<span><span class="co">#&gt; 2  &amp;  2.45 \newline {\footnotesize (1.80, 3.31)}  &amp;  0.59 \newline {\footnotesize (0.45, 0.73)}  &amp;  0.39 \newline {\footnotesize (0.26, 0.54)}  &amp;  0.01 \newline {\footnotesize (0.00, 0.04)}  &amp;  0.99 \newline {\footnotesize (0.89, 1.07)}\\</span></span>
<span><span class="co">#&gt; 3  &amp;  3.52 \newline {\footnotesize (2.21, 5.57)}  &amp;  0.34 \newline {\footnotesize (0.19, 0.54)}  &amp;  0.63 \newline {\footnotesize (0.44, 0.79)}  &amp;  0.01 \newline {\footnotesize (0.00, 0.09)}  &amp;  0.94 \newline {\footnotesize (0.81, 1.06)}\\</span></span>
<span><span class="co">#&gt; 4  &amp;  2.53 \newline {\footnotesize (1.19, 5.30)}  &amp;    &amp;  0.92 \newline {\footnotesize (0.63, 0.99)}  &amp;  0.08 \newline {\footnotesize (0.01, 0.37)}  &amp;  1.12 \newline {\footnotesize (0.84, 1.34)}\\</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="covariate-effects">Covariate effects<a class="anchor" aria-label="anchor" href="#covariate-effects"></a>
</h3>
<p>Form a tidy data frame with estimates and CIs to be plotted.</p>
<p>For the Markov model these are hazard ratios, and for the semi-Markov
model these are time acceleration factors and relative risks of a
particular next state.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbmodc</span>, pars<span class="op">=</span><span class="st">"hr"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ttype <span class="op">=</span> <span class="fu">trans_to_ttype</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span>,</span>
<span>         model <span class="op">=</span> <span class="st">"Markov"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">from</span>, <span class="va">name</span>, <span class="va">ttype</span>, <span class="va">posterior</span>, prior<span class="op">=</span><span class="va">prior</span><span class="op">)</span></span>
<span><span class="va">tafs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbmodscw</span>, pars<span class="op">=</span><span class="st">"taf"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">"Semi-Markov"</span>, ttype <span class="op">=</span> <span class="st">"Sojourn"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">from</span>, <span class="va">name</span>, <span class="va">ttype</span>, <span class="va">posterior</span>, <span class="va">prior</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_to_ttype_rr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">{</span> </span>
<span>  <span class="va">ttype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">to</span><span class="op">==</span><span class="fl">5</span>, <span class="st">"Death"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">from</span> <span class="op">&lt;</span> <span class="va">to</span>, <span class="st">"Progression"</span>, <span class="st">"Recovery"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">from</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Progression"</span>, <span class="st">"Recovery"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/%s"</span>,<span class="va">ttype</span>,<span class="va">base</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">rrnexts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mbmodscw</span>,pars <span class="op">=</span> <span class="st">"rrnext"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ttype <span class="op">=</span> <span class="fu">trans_to_ttype_rr</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span>,</span>
<span>         model <span class="op">=</span> <span class="st">"Semi-Markov"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">from</span>, <span class="va">name</span>, <span class="va">ttype</span>, <span class="va">posterior</span>, prior<span class="op">=</span><span class="va">prior</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cov_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female (for age 50)"</span><span class="op">=</span><span class="st">"genderwoman"</span>,</span>
<span>               <span class="st">"Age: 10 years (for female)"</span><span class="op">=</span><span class="st">"ageeff_woman"</span>,</span>
<span>               <span class="st">"Education: tertiary"</span><span class="op">=</span><span class="st">"raeducltertiary"</span>,</span>
<span>               <span class="st">"Education: upper secondary"</span><span class="op">=</span><span class="st">"raeducluppersec"</span>,</span>
<span>               <span class="st">"Age: 10 years (for male)"</span><span class="op">=</span><span class="st">"y5010"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">covres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">hrs</span>, <span class="va">tafs</span>, <span class="va">rrnexts</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Posterior<span class="op">=</span><span class="va">posterior</span>, Prior<span class="op">=</span><span class="va">prior</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>, <span class="st">"Prior"</span><span class="op">)</span>, names_to<span class="op">=</span><span class="st">"dist"</span>, values_to<span class="op">=</span><span class="st">"value"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".+\\((.+)\\)"</span>,<span class="st">"\\1"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="va">covres</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span><span class="op">==</span><span class="st">"genderwoman:y5010"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">covres</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span><span class="op">==</span><span class="st">"y5010"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ageeff<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">name</span><span class="op">)</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">from</span>, <span class="va">ttype</span>, <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">*</span> <span class="va">ageeff</span>,</span>
<span>         name <span class="op">=</span> <span class="st">"ageeff_woman"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">from</span>, <span class="va">name</span>, <span class="va">ttype</span>, <span class="va">dist</span>, <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covres</span> <span class="op">&lt;-</span> <span class="va">covres</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">!=</span> <span class="st">"genderwoman:y5010"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">inter</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">value</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="va">value</span><span class="op">$</span><span class="va">`2.5%`</span>, median <span class="op">=</span> <span class="va">value</span><span class="op">$</span><span class="va">`50%`</span>, upper <span class="op">=</span> <span class="va">value</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">from</span>, <span class="va">name</span>, <span class="va">ttype</span>, <span class="va">dist</span>, <span class="va">lower</span>, <span class="va">median</span>, <span class="va">upper</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"y5010"</span>, <span class="st">"ageeff_woman"</span>,</span>
<span>                            <span class="st">"genderwoman"</span>,<span class="st">"raeducluppersec"</span>,</span>
<span>                            <span class="st">"raeducltertiary"</span><span class="op">)</span>,</span>
<span>                            name <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">name</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">cov_codes</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Plot for Markov and semi-Markov separately.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">covres</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model</span><span class="op">==</span><span class="st">"Markov"</span>, <span class="va">dist</span><span class="op">==</span><span class="st">"Posterior"</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">median</span>, x<span class="op">=</span><span class="va">from</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, cols<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">ttype</span><span class="op">)</span>, </span>
<span>             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"gray70"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">lower</span>, ymax<span class="op">=</span><span class="va">upper</span><span class="op">)</span>, </span>
<span>                 position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                 show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Hazard ratio"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"From state"</span><span class="op">)</span></span>
<span><span class="va">p</span> </span></code></pre></div>
<p><img src="cognitive_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"../paper/figures/elsa_hrs.pdf"</span>,width<span class="op">=</span><span class="fl">5</span>,height<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">p</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">covres</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model</span><span class="op">==</span><span class="st">"Semi-Markov"</span>, <span class="va">dist</span><span class="op">==</span><span class="st">"Posterior"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ttype <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">ttype</span>, <span class="st">"Sojourn"</span>, <span class="st">"Death/Progression"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">median</span>, x<span class="op">=</span><span class="va">from</span>, lty<span class="op">=</span><span class="va">dist</span>, col<span class="op">=</span><span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span>ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, cols<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">ttype</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free_y"</span>, </span>
<span>             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"gray70"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">lower</span>, ymax<span class="op">=</span><span class="va">upper</span><span class="op">)</span>, </span>
<span>                 position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                 show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Posterior"</span>,<span class="st">"Prior"</span><span class="op">)</span>,values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"inside"</span>, title<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>        legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">'white'</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"From state"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Multiplicative effect"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"../paper/figures/elsa_smm.pdf"</span>,width<span class="op">=</span><span class="fl">5</span>,height<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">p</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="standardised-outputs-total-time-spent-in-states">Standardised outputs: total time spent in states<a class="anchor" aria-label="anchor" href="#standardised-outputs-total-time-spent-in-states"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"stdpop.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tls_educ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nd_educ</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/totlos.html">totlos</a></span><span class="op">(</span><span class="va">mbmodscg</span>, t<span class="op">=</span><span class="fl">10</span>, new_data<span class="op">=</span><span class="fu"><a href="../reference/standardise_to.html">standardise_to</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">tlm_educ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nd_educ</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/totlos.html">totlos</a></span><span class="op">(</span><span class="va">mbmodc</span>, t<span class="op">=</span><span class="fl">10</span>, new_data<span class="op">=</span><span class="fu"><a href="../reference/standardise_to.html">standardise_to</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">elevs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"less"</span>,<span class="st">"uppersec"</span>,<span class="st">"tertiary"</span><span class="op">)</span></span>
<span><span class="va">tles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">tls_educ</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>educ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">elevs</span>,levels<span class="op">=</span><span class="va">elevs</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>         state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span>,<span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">educ</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar-summaries-within-draws.html" class="external-link">rvar_sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"semi-Markov"</span>,</span>
<span>         tdiff <span class="op">=</span> <span class="va">posterior</span> <span class="op">-</span> <span class="va">posterior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tlem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">tlm_educ</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>educ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">elevs</span>, levels<span class="op">=</span><span class="va">elevs</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>         state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">educ</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar-summaries-within-draws.html" class="external-link">rvar_sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Markov"</span>,</span>
<span>         tdiff <span class="op">=</span> <span class="va">posterior</span> <span class="op">-</span> <span class="va">posterior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">tles</span>, <span class="va">tlem</span><span class="op">)</span> </span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">tle</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"tle.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By age, averaging over gender and education.. Age in the model is
continuous, but for standardisation we need to group the population, so
we obtain model outputs for the age group midpoints: 55, 65, 75, 85, 95
and assume these are homogeneous within age groups.</p>
<p>Note time dependent covariate, which is why we forecast over a short
prediction interval, 10 years.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tls_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nd_age</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/totlos.html">totlos</a></span><span class="op">(</span><span class="va">mbmodscg</span>, t<span class="op">=</span><span class="fl">10</span>, new_data<span class="op">=</span><span class="fu"><a href="../reference/standardise_to.html">standardise_to</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">tlm_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nd_age</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/totlos.html">totlos</a></span><span class="op">(</span><span class="va">mbmodc</span>, t<span class="op">=</span><span class="fl">10</span>, new_data<span class="op">=</span><span class="fu"><a href="../reference/standardise_to.html">standardise_to</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">alevs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"50-60"</span>,<span class="st">"60-70"</span>,<span class="st">"70-80"</span>,<span class="st">"80-90"</span>,<span class="st">"90-100"</span><span class="op">)</span></span>
<span><span class="va">tles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">tls_age</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alevs</span>,levels<span class="op">=</span><span class="va">alevs</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>         state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span>,<span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar-summaries-within-draws.html" class="external-link">rvar_sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"semi-Markov"</span>,</span>
<span>         tdiff <span class="op">=</span> <span class="va">posterior</span> <span class="op">-</span> <span class="va">posterior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tlem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">tlm_age</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alevs</span>, levels<span class="op">=</span><span class="va">alevs</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>         state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar-summaries-within-draws.html" class="external-link">rvar_sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Markov"</span>,</span>
<span>         tdiff<span class="op">=</span><span class="va">posterior</span> <span class="op">-</span> <span class="va">posterior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">tles</span>, <span class="va">tlem</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">tla</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"tla.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By gender</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tls_gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nd_gender</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/totlos.html">totlos</a></span><span class="op">(</span><span class="va">mbmodscw</span>, t<span class="op">=</span><span class="fl">10</span>, new_data<span class="op">=</span><span class="fu"><a href="../reference/standardise_to.html">standardise_to</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">tlm_gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nd_gender</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/totlos.html">totlos</a></span><span class="op">(</span><span class="va">mbmodc</span>, t<span class="op">=</span><span class="fl">10</span>, new_data<span class="op">=</span><span class="fu"><a href="../reference/standardise_to.html">standardise_to</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">alevs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nd_gender</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="va">x</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">tls_gender</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alevs</span>,levels<span class="op">=</span><span class="va">alevs</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>         state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar-summaries-within-draws.html" class="external-link">rvar_sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"semi-Markov"</span>,</span>
<span>         tdiff<span class="op">=</span><span class="va">posterior</span> <span class="op">-</span> <span class="va">posterior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tlem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">tlm_gender</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alevs</span>, levels<span class="op">=</span><span class="va">alevs</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>         state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>posterior <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/rvar-summaries-within-draws.html" class="external-link">rvar_sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"Markov"</span>,</span>
<span>         tdiff<span class="op">=</span><span class="va">posterior</span> <span class="op">-</span> <span class="va">posterior</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tlg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">tles</span>, <span class="va">tlem</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">tlg</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">wd</span>, <span class="st">"tlg.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tlg</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt;   gender   posterior model               tdiff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> woman   6.8 <span style="color: #949494;">± 0.29</span> semi-Markov   0.00 <span style="color: #949494;">± 0.00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> man     6.5 <span style="color: #949494;">± 0.30</span> semi-Markov  -0.35 <span style="color: #949494;">± 0.29</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> woman   6.9 <span style="color: #949494;">± 0.31</span> Markov        0.00 <span style="color: #949494;">± 0.00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> man     6.5 <span style="color: #949494;">± 0.44</span> Markov       -0.44 <span style="color: #949494;">± 0.30</span></span></span></code></pre></div>
<p>Results for all comparisons in a three panel figure</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tla</span> <span class="op">&lt;-</span> <span class="va">tla</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cov<span class="op">=</span><span class="st">"Age"</span>, </span>
<span>         age <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">age</span>, <span class="st">"55"</span><span class="op">=</span><span class="st">"50-60"</span>, <span class="st">"65"</span><span class="op">=</span><span class="st">"60-70"</span>, </span>
<span>                          <span class="st">"75"</span><span class="op">=</span><span class="st">"70-80"</span>, <span class="st">"85"</span><span class="op">=</span><span class="st">"80-90"</span>,<span class="st">"95"</span><span class="op">=</span><span class="st">"90-100"</span><span class="op">)</span>,</span>
<span>         model<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"Semi-Markov"</span><span class="op">=</span><span class="st">"semi-Markov"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">tlg</span> <span class="op">&lt;-</span> <span class="va">tlg</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cov<span class="op">=</span><span class="st">"Sex"</span>,</span>
<span>         model<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"Semi-Markov"</span><span class="op">=</span><span class="st">"semi-Markov"</span><span class="op">)</span>,</span>
<span>         gender <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">gender</span>, <span class="st">"Male"</span><span class="op">=</span><span class="st">"man"</span>, <span class="st">"Female"</span><span class="op">=</span><span class="st">"woman"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tle</span> <span class="op">&lt;-</span> <span class="va">tle</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cov<span class="op">=</span><span class="st">"Education"</span>,</span>
<span>         model<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"Semi-Markov"</span><span class="op">=</span><span class="st">"semi-Markov"</span><span class="op">)</span>,</span>
<span>         educ <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">educ</span>, <span class="st">"Less"</span><span class="op">=</span><span class="st">"less"</span>, </span>
<span>                           <span class="st">"Upper secondary"</span><span class="op">=</span><span class="st">"uppersec"</span>, <span class="st">"Tertiary"</span><span class="op">=</span><span class="st">"tertiary"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># psize &lt;- 24 # for interactive use, for paper </span></span>
<span><span class="va">psize</span> <span class="op">&lt;-</span> <span class="fl">16</span> <span class="co"># for automated use, for website</span></span>
<span></span>
<span><span class="va">ga</span> <span class="op">&lt;-</span> <span class="va">tla</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">age</span>, col<span class="op">=</span><span class="va">age</span>, lty<span class="op">=</span><span class="va">model</span>, xdist<span class="op">=</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="https://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">ggstance</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggstance/man/position-vertical.html" class="external-link">position_dodgev</a></span><span class="op">(</span>height<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                             interval_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, fatten_point<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"none"</span>, </span>
<span>         lty <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"inside"</span>, title<span class="op">=</span><span class="st">""</span>, reverse<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>        legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">'white'</span>, <span class="fl">0.4</span><span class="op">)</span>, </span>
<span>                                         color<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="va">psize</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Years"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"By age"</span><span class="op">)</span></span>
<span><span class="va">ga</span></span></code></pre></div>
<p><img src="cognitive_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">tlg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">gender</span>, col<span class="op">=</span><span class="va">gender</span>, lty<span class="op">=</span><span class="va">model</span>, xdist<span class="op">=</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="https://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">ggstance</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggstance/man/position-vertical.html" class="external-link">position_dodgev</a></span><span class="op">(</span>height<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                             interval_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, fatten_point<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"none"</span>, lty<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="va">psize</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Years"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"By sex"</span><span class="op">)</span></span>
<span><span class="va">gg</span></span></code></pre></div>
<p><img src="cognitive_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ge</span> <span class="op">&lt;-</span> <span class="va">tle</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">educ</span>, col<span class="op">=</span><span class="va">educ</span>, lty<span class="op">=</span><span class="va">model</span>, xdist<span class="op">=</span><span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="https://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">ggstance</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggstance/man/position-vertical.html" class="external-link">position_dodgev</a></span><span class="op">(</span>height<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                             interval_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, fatten_point<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"none"</span>, lty<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="va">psize</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Years"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"By highest level of education"</span><span class="op">)</span></span>
<span><span class="va">ge</span></span></code></pre></div>
<p><img src="cognitive_files/figure-html/unnamed-chunk-12-3.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">ga</span>, <span class="va">gg</span>, <span class="va">ge</span>, align<span class="op">=</span><span class="st">"v"</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p</span> </span></code></pre></div>
<p><img src="cognitive_files/figure-html/unnamed-chunk-12-4.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">save_files</span><span class="op">)</span><span class="op">{</span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"elsa_totlos.pdf"</span><span class="op">)</span></span>
<span> <span class="co">## png("elsa_totlos.png", width=640, height=640, pointsize=24)</span></span>
<span> <span class="va">p</span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
