<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Misclassification multi-state models in msmbayes • msmbayes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Misclassification multi-state models in msmbayes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">msmbayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">Examples of using msmbayes</a>
    </li>
    <li>
      <a href="../articles/misclass.html">Misclassification multi-state models in msmbayes</a>
    </li>
    <li>
      <a href="../articles/semimarkov.html">Semi-Markov models with msmbayes</a>
    </li>
    <li>
      <a href="../articles/nphase.html">Advanced phase-type models in msmbayes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chjackson/msmbayes/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Misclassification multi-state models in
msmbayes</h1>
                        <h4 data-toc-skip class="author">Christopher
Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk" class="email">chris.jackson@mrc-bsu.cam.ac.uk</a>
</h4>
            
            <h4 data-toc-skip class="date">2025-01-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msmbayes/blob/HEAD/vignettes/misclass.Rmd" class="external-link"><code>vignettes/misclass.Rmd</code></a></small>
      <div class="hidden name"><code>misclass.Rmd</code></div>

    </div>

    
    
<p>In a <strong>hidden Markov model</strong>, an individual moves
between a set of latent, unobserved states according to a Markov
process. The observed data are generated conditionally on the latent
states.</p>
<div class="section level2">
<h2 id="multi-state-models-with-misclassification">Multi-state models with misclassification<a class="anchor" aria-label="anchor" href="#multi-state-models-with-misclassification"></a>
</h2>
<p>Hidden Markov models can be used to account for misclassification of
states in a multi-state model.</p>
<p>To fit a misclassification multi-state models in
<code>msmbayes</code>, the structure of allowed misclassifications is
supplied in the <code>E</code> argument (the “e” stands for “emission”).
This is a matrix with off-diagonal entries:</p>
<ul>
<li><p>1 if true state [row number] can be misclassified as [column
number]</p></li>
<li><p>0 if true state [row number] cannot be misclassified as [column
number]</p></li>
</ul>
<p>The diagonal entries of <code>E</code> are ignored (as for the
<code>Q</code> argument).</p>
<p>The following example is discussed in the <a href="https://cran.r-project.org/web/packages/msm/vignettes/msm-manual.pdf" class="external-link"><code>msm</code>
user guide</a> (Section 2.14). We model progression between three states
of CAV (a disease experienced by heart transplant recipients), and allow
death from any of these states. True state 1 can be misclassified as 2,
true state 2 can be misclassified as 1 or 3, and true state 3 can be
misclassified as 2.</p>
<p>For speed in this demo, we use Stan’s <code>"optimize"</code> method,
which uses the simple normal approximation to the posterior. MCMC would
probably be more sensible in a real application.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msmbayes" class="external-link">msmbayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msm" class="external-link">msm</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'msm' was built under R version 4.4.2</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Qcav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ecav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">cav</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"years"</span>, subject<span class="op">=</span><span class="st">"PTNUM"</span>, </span>
<span>                  Q<span class="op">=</span><span class="va">Qcav</span>, E<span class="op">=</span><span class="va">Ecav</span>, fit_method<span class="op">=</span><span class="st">"optimize"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/qmatrix.html">qmatrix</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## rvar&lt;4000&gt;[4,4] <span style="color: #949494;">mean ± sd:</span></span></span>
<span><span class="co">##      [,1]             [,2]             [,3]             [,4]            </span></span>
<span><span class="co">## [1,] -0.143 ± 0.0087   0.096 ± 0.0078   0.000 ± 0.0000   0.047 ± 0.0048 </span></span>
<span><span class="co">## [2,]  0.000 ± 0.0000  -0.279 ± 0.0288   0.214 ± 0.0304   0.065 ± 0.0233 </span></span>
<span><span class="co">## [3,]  0.000 ± 0.0000   0.000 ± 0.0000  -0.369 ± 0.0490   0.369 ± 0.0490 </span></span>
<span><span class="co">## [4,]  0.000 ± 0.0000   0.000 ± 0.0000   0.000 ± 0.0000   0.000 ± 0.0000</span></span></code></pre>
<p>The function <code>edf</code> extracts the misclassification (or
“emission”) probabilities in a tidy data frame form.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/edf.html">edf</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">##    from    to           value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1     2  0.014 <span style="color: #949494;">± 0.0041</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2     1  0.228 <span style="color: #949494;">± 0.0367</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     2     3  0.065 <span style="color: #949494;">± 0.0160</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     3     2  0.140 <span style="color: #949494;">± 0.0395</span></span></span></code></pre>
<p>An identical non-Bayesian model is fitted using
<code><a href="https://chjackson.github.io/msm/reference/msm.html" class="external-link">msm()</a></code>.</p>
<blockquote>
<p><strong>Note</strong>: this is different from the model fitted in the
<code>msm</code> manual, since “exact death times” are not supported in
<code>msmbayes</code>. Also note that <code>msm</code> requires
informative initial values for the non-zero intensities and
misclassification probabilities here. For hidden Markov models,
<code>msm</code> is not smart enough to determine good initial values
automatically given the transition structure.</p>
</blockquote>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Qcav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.148</span>, <span class="fl">0</span>, <span class="fl">0.0171</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.202</span>, <span class="fl">0.081</span><span class="op">)</span>, </span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.126</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ecav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cav.msm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://chjackson.github.io/msm/reference/msm.html" class="external-link">msm</a></span><span class="op">(</span><span class="va">state</span> <span class="op">~</span> <span class="va">years</span>, subject<span class="op">=</span><span class="va">PTNUM</span>, data<span class="op">=</span><span class="va">cav</span>, qmatrix<span class="op">=</span><span class="va">Qcav</span>, ematrix<span class="op">=</span><span class="va">Ecav</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://chjackson.github.io/msm/reference/qmatrix.msm.html" class="external-link">qmatrix.msm</a></span><span class="op">(</span><span class="va">cav.msm</span>, ci<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            State 1     State 2    State 3    State 4</span></span>
<span><span class="co">## State 1 -0.1452746  0.09855669  0.0000000 0.04671790</span></span>
<span><span class="co">## State 2  0.0000000 -0.26352026  0.2013230 0.06219724</span></span>
<span><span class="co">## State 3  0.0000000  0.00000000 -0.3671024 0.36710242</span></span>
<span><span class="co">## State 4  0.0000000  0.00000000  0.0000000 0.00000000</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://chjackson.github.io/msm/reference/ematrix.msm.html" class="external-link">ematrix.msm</a></span><span class="op">(</span><span class="va">cav.msm</span>, ci<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           State 1     State 2    State 3 State 4</span></span>
<span><span class="co">## State 1 0.9919222 0.008077811 0.00000000       0</span></span>
<span><span class="co">## State 2 0.2379674 0.710858571 0.05117404       0</span></span>
<span><span class="co">## State 3 0.0000000 0.112813389 0.88718661       0</span></span>
<span><span class="co">## State 4 0.0000000 0.000000000 0.00000000       1</span></span></code></pre>
<p>The parameter estimates from <code>msm</code> are close to those from
<code>msmbayes</code>, with any differences explainable by the influence
of the weak prior.</p>
<div class="section level3">
<h3 id="specifiying-prior-distributions-for-misclassification-probabilities">Specifiying prior distributions for misclassification
probabilities<a class="anchor" aria-label="anchor" href="#specifiying-prior-distributions-for-misclassification-probabilities"></a>
</h3>
<p>In <code>msmbayes</code>, normal prior distributions are assumed for
the <em>log odds</em> of misclassification. Denote the misclassification
error probability by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">e_{rs}</annotation></semantics></math>,
the probability that an individual in state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
is observed in state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>.
The corresponding log odds of misclassification is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>e</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><mi>/</mi><msub><mi>e</mi><mrow><mi>r</mi><mi>r</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">log(e_{rs} / e_{rr})</annotation></semantics></math>,
the log odds of being misclassified in state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
relative to no misclassification.</p>
<p>The default normal(0,1) for these log odds parameters is intended to
give a roughly uniform distribution on the scale of probabilities.</p>
<p>To specify the mean and SD of these normal priors by hand, use
<code>msmprior</code> as follows, with <code>loe(r,s)</code> indicating
the log-odds of misclassication of state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
as state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/msmprior.html">msmprior</a></span><span class="op">(</span><span class="st">"loe(1,2)"</span>, mean<span class="op">=</span><span class="op">-</span><span class="fl">2</span>, sd<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">draws_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">cav</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"years"</span>, subject<span class="op">=</span><span class="st">"PTNUM"</span>, </span>
<span>                  Q<span class="op">=</span><span class="va">Qcav</span>, E<span class="op">=</span><span class="va">Ecav</span>, fit_method<span class="op">=</span><span class="st">"optimize"</span>, priors<span class="op">=</span><span class="va">priors</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/edf.html">edf</a></span><span class="op">(</span><span class="va">draws_prior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">##    from    to           value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1     2  0.039 <span style="color: #949494;">± 0.0043</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2     1  0.165 <span style="color: #949494;">± 0.0328</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     2     3  0.080 <span style="color: #949494;">± 0.0192</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     3     2  0.135 <span style="color: #949494;">± 0.0383</span></span></span></code></pre>
<p>If there is only one potential misclassification
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
for some state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>,
then the log odds of misclassification is just the standard logit of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">e_{rs}</annotation></semantics></math>.
In the above model, the prior median 95% credible interval implied by
the normal(-2, 0.2) prior can be deduced by taking the inverse logit of
the prior quantiles. This prior is fairly tight around a
misclassification probability of 0.1, and appears to have the effect of
pulling it away from the value estimated from the data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.08378533 0.11920292 0.16686547</span></span></code></pre>
<p>With multiple misclassification possibilities per true state, a
multinomial logit transform is needed. To deduce the prior beliefs about
probabilities implied by a particular prior mean and SD, a simple
approach is to use simulation. For a particular true state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>,
simulate from the normal priors for all potential observed states
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
then use an inverse multinomial logit transform to deduce the
corresponding sample for the set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">e_{rs}</annotation></semantics></math>,
which satisfies
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>s</mi></msub><msub><mi>e</mi><mrow><mi>r</mi><mi>s</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_s e_{rs} = 1</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="fixed-misclassification-probabilities">Fixed misclassification probabilities<a class="anchor" aria-label="anchor" href="#fixed-misclassification-probabilities"></a>
</h3>
<p>Misclassification error probabilities in multi-state models for
intermittently-observed data are often not identifiable from data.
Typically, background information about the observation process is
needed. If there is good evidence about the error proabilities, it may
be sufficient to fix these at constant values. In <code>msmbayes</code>,
this can be done with the <code>Efix</code> argument. This is a matrix
matching the dimensions of <code>E</code>, but with any fixed error
probabilities supplied in the appropriate places, and zero elsewhere.
The following model fixes the probability that true state 1 is
misclassified as 2 to 0.1.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Efix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">draws_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">cav</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"years"</span>, subject<span class="op">=</span><span class="st">"PTNUM"</span>, </span>
<span>                      Q<span class="op">=</span><span class="va">Qcav</span>, E<span class="op">=</span><span class="va">Ecav</span>, Efix<span class="op">=</span><span class="va">Efix</span>, fit_method<span class="op">=</span><span class="st">"optimize"</span><span class="op">)</span></span></code></pre></div>
<p>Using a prior is a compromise between fixing these parameters and
attempting to identify them from data. An advantage of the Bayesian
approach is that, as long as the computational algorithm works, we have
a valid posterior. Then if the marginal posterior for this parameter is
the same as the prior, we can deduce there is no information in the data
about this particular parameter. If this prior is defensible, we still
have a useful model for the data.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
