<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced phase-type models in msmbayes • msmbayes</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced phase-type models in msmbayes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msmbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examples.html">Examples of using msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/misclass.html">Misclassification multi-state models in msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/semimarkov.html">Semi-Markov models with msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/nphase.html">Advanced phase-type models in msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/cognitive.html">Code for using the msmbayes package for semi-Markov modelling in an application to cognitive function</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/msmbayes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced phase-type models in msmbayes</h1>
                        <h4 data-toc-skip class="author">Christopher
Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk" class="email">chris.jackson@mrc-bsu.cam.ac.uk</a>
</h4>
            
            <h4 data-toc-skip class="date">2025-08-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msmbayes/blob/HEAD/vignettes/nphase.Rmd" class="external-link"><code>vignettes/nphase.Rmd</code></a></small>
      <div class="d-none name"><code>nphase.Rmd</code></div>
    </div>

    
    
<p>To fit a model with non-exponential sojourn distributions
(semi-Markov model) in <code>msmbayes</code>, the easiest way is to use
phase-type approximations to Weibull and Gamma distributions, as
explained in the <a href="semimarkov.html">vignette about this
technique</a> These represent the sojourn distribution with two
parameters - which may be all that is possible to identify from data
where the state is only intermittently observed.</p>
<p>A more advanced approach to semi-Markov modelling in
<code>msmbayes</code> is to specify a phase-type distribution
directly.</p>
<div class="section level2">
<h2 id="phase-type-semi-markov-models">Phase-type semi-Markov models<a class="anchor" aria-label="anchor" href="#phase-type-semi-markov-models"></a>
</h2>
<p>In a multi-state model, suppose we do not believe the sojourn time in
a particular state follows an exponential distribution. For example, in
the infection model, suppose we do not believe that the time spent in
the “test positive” state is exponential.</p>
<p><img src="../reference/figures/twostate.png" alt="A two-state Markov model" width="500px"></p>
<p>We can relax this assumption by building a
<strong>“semi-Markov”</strong> model, where the sojourn time in this
state follows a more complex distribution. One way to do this is to
replace this state by a series of two (or more) latent or hidden states,
known as “phases”. For example, with two phases:</p>
<p><img src="../reference/figures/twostatephase.png" alt="A phase-type model with two observable states, one of which has two phases" width="600px"></p>
<blockquote>
<p>In a phase-type model, we allow progression from one phase to the
next, but not transitions from later to earlier phases (or jumps between
non-adjacent phases, if there are 3 phases or more). Otherwise, we allow
the same transitions out of each phase as were allowed in the original
model (to state 1, in this example)</p>
</blockquote>
<p>We then assume transitions between and out of the phases follow
exponential distributions. That is, we assume a Markov model on the
latent state space. The test-positive state then has a sojourn
distribution known as the <a href="https://en.wikipedia.org/wiki/Phase-type_distribution#Coxian_distribution" class="external-link">“Coxian”
phase-type</a> distribution, instead of the exponential.</p>
<blockquote>
<p><strong>Note</strong>: This is an example of a <strong>hidden Markov
model</strong>, though one of a specific form where some states are
observed correctly, and some states are latent. Phase-type models are a
convenient way to build semi-Markov models for intermittently-observed
data, because there are standard algorithms for computing the likelihood
of a hidden Markov model.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="fitting-phase-type-models-in-msmbayes">Fitting phase-type models in msmbayes<a class="anchor" aria-label="anchor" href="#fitting-phase-type-models-in-msmbayes"></a>
</h2>
<p>To assume a phase-type sojourn distribution for one or more states in
a <code>msmbayes</code> model, set the <code>nphase</code> argument.
This is a vector of length equal to the number of states, giving the
number of phases per state. Any elements of <code>nphase</code> that are
1 correspond to states with the usual exponential sojourn
distribution.</p>
<div class="section level3">
<h3 id="example-data-simulated-from-a-standard-markov-model">Example: data simulated from a standard Markov model<a class="anchor" aria-label="anchor" href="#example-data-simulated-from-a-standard-markov-model"></a>
</h3>
<p>Here we extend the 2-state model for the simulated infection data to
give state 2 (infection) a two-phase sojourn distribution. These data
were originally simulated assuming an exponential sojourn distribution
in state 2 (with rate 3). In this situation, we would expect the
estimated rates of transition out of each phase to be identical.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msmbayes" class="external-link">msmbayes</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span><span class="va">infsim2</span>, state<span class="op">=</span><span class="st">"state"</span>, time<span class="op">=</span><span class="st">"months"</span>, subject<span class="op">=</span><span class="st">"subject"</span>,</span>
<span>                  Q<span class="op">=</span><span class="va">Q</span>, nphase<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, fit_method <span class="op">=</span> <span class="st">"optimize"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   name  from  to        posterior   mode prior_string                prior</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> q     1     2p1    0.74 <span style="color: #949494;">± 0.35</span>  0.674  0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> q     2p1   1      4.37 <span style="color: #949494;">± 2.08</span>  3.99   0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> q     2p1   2p2    0.32 <span style="color: #949494;">± 1.96</span>  0.038<span style="text-decoration: underline;">2</span> 0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> q     2p2   1      7.43 <span style="color: #949494;">± 54.31</span> 0.758  0.14 (0.0027, 6.8)   0.96 <span style="color: #949494;">± 4.4</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> mst   1     <span style="color: #BB0000;">NA</span>     1.65 <span style="color: #949494;">± 0.77</span>  1.48   7.4 (0.147, 372)    52.22 <span style="color: #949494;">± 237.6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> mst   2     <span style="color: #BB0000;">NA</span>     0.30 <span style="color: #949494;">± 0.16</span>  0.261  <span style="color: #BB0000;">NA</span>                     NA <span style="color: #949494;">± NA</span></span></span></code></pre>
<p>The phased states are labelled specially here, e.g. the first phase
of state 2 is labelled <code>"2p1"</code>. The estimated transition
rates from the two phases of state 2 to state 1 are not significantly
different from 2 - but there is large uncertainty around the estimated
rates, since this model is over-fitted to the data. Implementing the
same model in <code>msm</code> would give extremely large confidence
intervals around the estimated rates.</p>
</div>
<div class="section level3">
<h3 id="example-data-simulated-from-a-phase-type-model">Example: data simulated from a phase-type model<a class="anchor" aria-label="anchor" href="#example-data-simulated-from-a-phase-type-model"></a>
</h3>
<p>The following code simulates a dataset from the following phase-type
model structure</p>
<p><img src="../reference/figures/threestatephase.png" alt="A phase-type model with three observable states, where the first state has two phases" width="600px"></p>
<p>with a transition intensity matrix (on the latent state space) given
in the R object <code>Qg</code>. This code uses the ability of the
function <code><a href="https://chjackson.github.io/msm/reference/simmulti.msm.html" class="external-link">simmulti.msm()</a></code> from the <code>msm</code> package
to simulate from hidden Markov models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Qg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.18</span>, <span class="fl">0.008</span>, <span class="fl">0.012</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>,    <span class="fl">0.016</span>, <span class="fl">0.024</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>,    <span class="fl">0</span>,     <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>,    <span class="fl">0</span>,     <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># hidden Markov model misclassification matrix</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nsubj</span> <span class="op">&lt;-</span> <span class="fl">10000</span>; <span class="va">nobspt</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsubj</span>, each<span class="op">=</span><span class="va">nobspt</span><span class="op">)</span>,</span>
<span>                     time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, length<span class="op">=</span><span class="va">nobspt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chjackson/msm" class="external-link">msm</a></span><span class="op">)</span></span>
<span><span class="va">sim.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://chjackson.github.io/msm/reference/simmulti.msm.html" class="external-link">simmulti.msm</a></span><span class="op">(</span><span class="va">sim.df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, qmatrix<span class="op">=</span><span class="va">Qg</span>, ematrix<span class="op">=</span><span class="va">E</span><span class="op">)</span></span></code></pre></div>
<p>We fit the phase-type model to the simulated data using both
<code>msmbayes</code> and <code>msm</code>.</p>
<p>The fast optimization-based method is used to approximate the
Bayesian posterior here, for speed of demonstration, but in practice we
would generally want to cross-check the results with MCMC. The posterior
distributions for these models are likely to have a skewed and
multimodal shape which is not represented well by a normal
approximation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmbayes.html">msmbayes</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim.df</span>, state<span class="op">=</span><span class="st">"obs"</span>, time<span class="op">=</span><span class="st">"time"</span>, subject<span class="op">=</span><span class="st">"subject"</span>,</span>
<span>                  Q<span class="op">=</span><span class="va">Q3</span>, nphase<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, fit_method<span class="op">=</span><span class="st">"optimize"</span><span class="op">)</span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_dens</a></span><span class="op">(</span><span class="va">draws</span>, pars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"logq[%s]"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="nphase_files/figure-html/unnamed-chunk-8-1.png" alt="Posterior density estimates" width="700"></p>
<p><code>msm</code> needs some tuning to converge, in particular the use
of <code>fnscale</code> and explicit initial values for the transition
rate. In practice, sensitivity analysis to these initial values would be
needed to confirm that the reported estimates are the global maximum
likelihood estimates, rather than one of the local maxima or saddle
points.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s.msm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://chjackson.github.io/msm/reference/msm.html" class="external-link">msm</a></span><span class="op">(</span><span class="va">obs</span> <span class="op">~</span> <span class="va">time</span>, subject<span class="op">=</span><span class="va">subject</span>, data<span class="op">=</span><span class="va">sim.df</span>, phase.states<span class="op">=</span><span class="fl">1</span>, qmatrix<span class="op">=</span><span class="va">Q3</span>,</span>
<span>             phase.inits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trans<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># seems to need these</span></span>
<span>                                   exit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">4</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">1</span>,REPORT<span class="op">=</span><span class="fl">1</span>,fnscale<span class="op">=</span><span class="fl">50000</span>,maxit<span class="op">=</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Reassuringly, the Bayesian and frequentist methods give similar
estimates of the transition intensities, which agree (within estimation
error) with the values used for simulation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/qmatrix.html">qmatrix</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## rvar&lt;4000&gt;[4,4] <span style="color: #949494;">mean ± sd:</span></span></span>
<span><span class="co">##     1p1               1p2               2                 3                </span></span>
<span><span class="co">## 1p1 -0.0413 ± 0.0026   0.0210 ± 0.0057   0.0098 ± 0.0045   0.0105 ± 0.0037 </span></span>
<span><span class="co">## 1p2  0.0000 ± 0.0000  -0.2587 ± 0.0911   0.0975 ± 0.0580   0.1611 ± 0.0528 </span></span>
<span><span class="co">## 2    0.0000 ± 0.0000   0.0000 ± 0.0000  -0.2012 ± 0.0062   0.2012 ± 0.0062 </span></span>
<span><span class="co">## 3    0.0000 ± 0.0000   0.0000 ± 0.0000   0.0000 ± 0.0000   0.0000 ± 0.0000</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://chjackson.github.io/msm/reference/qmatrix.msm.html" class="external-link">qmatrix.msm</a></span><span class="op">(</span><span class="va">s.msm</span>,ci<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              State 1 [P1] State 1 [P2]     State 2    State 3</span></span>
<span><span class="co">## State 1 [P1]   -0.1986608   0.17706760  0.01059025 0.01100295</span></span>
<span><span class="co">## State 1 [P2]    0.0000000  -0.03930873  0.01593401 0.02337472</span></span>
<span><span class="co">## State 2         0.0000000   0.00000000 -0.20150880 0.20150880</span></span>
<span><span class="co">## State 3         0.0000000   0.00000000  0.00000000 0.00000000</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Qg</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2]  [,3]  [,4]</span></span>
<span><span class="co">## [1,]    0 0.18 0.008 0.012</span></span>
<span><span class="co">## [2,]    0 0.00 0.016 0.024</span></span>
<span><span class="co">## [3,]    0 0.00 0.000 0.200</span></span>
<span><span class="co">## [4,]    0 0.00 0.000 0.000</span></span></code></pre>
<p>The mean sojourn times in states of a phase-type model can either be
calculated for the observable state space (<code>states="obs"</code>,
the default), or the latent state space
(<code>states="phase"</code>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mean_sojourn.html">mean_sojourn</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">##   state  posterior  mode</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1  26 <span style="color: #949494;">± 1.47</span> 27.7 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2   5 <span style="color: #949494;">± 0.15</span>  4.98</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mean_sojourn.html">mean_sojourn</a></span><span class="op">(</span><span class="va">draws</span>, states<span class="op">=</span><span class="st">"phase"</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   state    posterior  mode stateobs statephase</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1p1    24.3 <span style="color: #949494;">± 1.36</span> 25.5         1          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 1p2     4.3 <span style="color: #949494;">± 1.48</span>  4.23        1          2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 2       5.0 <span style="color: #949494;">± 0.15</span>  4.98        2          1</span></span></code></pre>
<p>More practical experience of using general phase-type models for
intermittently-observed multi-state data is needed. In particular:</p>
<ul>
<li><p>How to specify substantive prior information. In the examples
above, the default log-normal(-2,2) priors were used for transition
intensities. But we need a better way to choose these based on
judgements about interpretable quantities, e.g. the mean sojourn time in
the phased state.</p></li>
<li><p>Limited experience suggests that the Bayesian method is more
likely than <code>msm</code> to produce a plausible result without the
need for tuning. However, can the sampling algorithms always be relied
upon?</p></li>
<li><p>How to build and interpret models with covariates on intensities.
Covariates can be placed on intensities for transitions in the phased
state-space, but this has not been tested in practice. There is a risk
of over-fitting, and strong constraints on covariate effects are
expected to be necessary.</p></li>
</ul>
<p>However, with intermittently-observed data, it is uncertain to what
extent we will be able to identify a detailed shape for the sojourn
distribution from the data. Therefore using <a href="semimarkov.html">phase-type approximations to shape-scale
distributions</a> is expected to be a more useful approach to
semi-Markov modelling.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
