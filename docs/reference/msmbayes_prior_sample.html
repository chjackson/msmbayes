<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a sample from the prior distribution in a msmbayes model — msmbayes_prior_sample • msmbayes</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a sample from the prior distribution in a msmbayes model — msmbayes_prior_sample"><meta name="description" content="Called in the same way as msmbayes.  The data should
still be supplied in this function, to ensure we are simulating
from a valid msmbayes model, but it is sufficient to
supply an empty data frame with no rows, and columns named as if
we were fitting a model with the given priors."><meta property="og:description" content="Called in the same way as msmbayes.  The data should
still be supplied in this function, to ensure we are simulating
from a valid msmbayes model, but it is sufficient to
supply an empty data frame with no rows, and columns named as if
we were fitting a model with the given priors."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">msmbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/examples.html">Examples of using msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/misclass.html">Misclassification multi-state models in msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/semimarkov.html">Semi-Markov models with msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/nphase.html">Advanced phase-type models in msmbayes</a></li>
    <li><a class="dropdown-item" href="../articles/cognitive.html">Code for using the msmbayes package for semi-Markov modelling in an application to cognitive function</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/msmbayes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate a sample from the prior distribution in a msmbayes model</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/msmbayes/blob/HEAD/R/prior_sample.R" class="external-link"><code>R/prior_sample.R</code></a></small>
      <div class="d-none name"><code>msmbayes_prior_sample.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Called in the same way as <code><a href="msmbayes.html">msmbayes</a></code>.  The data should
still be supplied in this function, to ensure we are simulating
from a valid <code><a href="msmbayes.html">msmbayes</a></code> model, but it is sufficient to
supply an empty data frame with no rows, and columns named as if
we were fitting a model with the given priors.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">msmbayes_prior_sample</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject"</span>,</span>
<span>  <span class="va">Q</span>,</span>
<span>  covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pastates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pafamily <span class="op">=</span> <span class="st">"weibull"</span>,</span>
<span>  panphase <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nphase <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  E <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  priors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame giving the observed data.</p></dd>


<dt id="arg-state">state<a class="anchor" aria-label="anchor" href="#arg-state"></a></dt>
<dd><p>Character string naming the observed state variable in
the data.  This variable must either be an integer in 1,2,...,K,
where K is the number of states, or a factor with these integers
as level labels.  If omitted, this is assumed to be <code>"state"</code>.</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>Character string naming the observation time variable in the data.
If omitted, this is assumed to be <code>"time"</code>.</p></dd>


<dt id="arg-subject">subject<a class="anchor" aria-label="anchor" href="#arg-subject"></a></dt>
<dd><p>Character string naming the individual ID variable in the data.
If omitted, this is assumed to be <code>"subject"</code>.</p></dd>


<dt id="arg-q">Q<a class="anchor" aria-label="anchor" href="#arg-q"></a></dt>
<dd><p>Matrix indicating the transition structure.  A zero entry
indicates that instantaneous transitions from (row) to (column)
are disallowed.  An entry of 1 (or any other positive value)
indicates that the instantaneous transition is allowed.  The
diagonal of <code>Q</code> is ignored.</p>
<p>There is no need to "guess" initial values and put them here, as
is sometimes done in <code>msm</code>.  Initial values for fitting are
determined by Stan from the prior distributions, and the specific
values supplied for positive entries of <code>Q</code> are disregarded.</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>Specification of covariates on transition intensities.
This should be a list of formulae, or a single formula.</p>
<p>If a list is supplied, each formula should have a
left-hand side that looks like <code>Q(r,s)</code>, and a right hand side
defining the regression model for the log of the transition intensity
from state \(r\) to state \(s\).</p>
<p>For example,</p>
<p><code>covariates = list(Q(1,2) ~ age + sex,
                        Q(2,1) ~ age)</code></p>
<p>specifies that the log of the 1-2 transition intensity is an additive
linear function of age and sex, and the log 2-1 transition intensity
is a linear function of age.  You do not have to list all of the
intensities here if some of them are not influenced by covariates.</p>
<p>If a single formula is supplied, this is assumed to apply to all
intensities.  If doing this, then take care with potential lack of
identifiability of effects from sparse data.</p>
<p>In models with phase-type approximated states (specified with
<code>pastates</code>), covariates are modelled through an accelerated failure
time model.  The effect is a multiplier on the scale parameter of
the sojourn distribution.  The covariate then has an identical
multiplicative effect on all rates of transition between phases for
a given state.  The left hand side of the formula should contain
<code>scale</code> instad of <code>Q</code>.  For example, if state 1 has a phase type
approximation, but state 2 is Markov, then we might supply
<code>covariates</code> as:</p>
<p><code>covariates = list(scale(1) ~ age + sex,
                        Q(2,1) ~ age)</code></p>
<p>In models with phase-type approximations and competing exit states,
covariates on the relative risk of different exit states are
specified with a formula with <code>rrnext</code> on the left hand side.  For
example in a model where state 1 has a phase-type approximation,
and the next state could be either 2 or 3, a linear model on the
log relative risk of transition to 3 (relative to the baseline 2)
might be specified as:</p>
<p><code>covariates = list(scale(1) ~ age + sex,
                        rrnext(1,3) ~ x + time)</code></p>
<p>In phase-type models specified with <code>nphase</code>, or misclassification
models (specified with <code>E</code>), covariates on transition intensities
are specified with <code>Q()</code>, where the numbers inside <code>Q()</code> refer to
the latent state space.</p></dd>


<dt id="arg-pastates">pastates<a class="anchor" aria-label="anchor" href="#arg-pastates"></a></dt>
<dd><p>This indicates which states (if any) are given a
Weibull or Gamma sojourn distribution approximated by a phase-type model
Ignored if <code>nphase</code> is supplied.</p></dd>


<dt id="arg-pafamily">pafamily<a class="anchor" aria-label="anchor" href="#arg-pafamily"></a></dt>
<dd><p><code>"weibull"</code> or <code>"gamma"</code>, indicating the
approximated sojourn distribution in the phased state.  Either a
vector of the same length as <code>pastates</code>, or just one to apply to
all states.</p></dd>


<dt id="arg-panphase">panphase<a class="anchor" aria-label="anchor" href="#arg-panphase"></a></dt>
<dd><p>Number of phases to use for each state given a
phase-type Gamma or Weibull approximation.  Vector of same length
as <code>pastates</code>. More phases allow a wider range of shape parameters.</p></dd>


<dt id="arg-nphase">nphase<a class="anchor" aria-label="anchor" href="#arg-nphase"></a></dt>
<dd><p>Only required for models with phase-type sojourn
distributions specified directly (not through <code>pastates</code>).
<code>nphase</code> is a vector with one element per state, giving the
number of phases per state.  This element is 1 for states that do
not have phase-type sojourn distributions.</p></dd>


<dt id="arg-e">E<a class="anchor" aria-label="anchor" href="#arg-e"></a></dt>
<dd><p>By default, <code>msmbayes</code> fits a (non-hidden) Markov model.
If <code>E</code> is supplied, then a Markov model with misclassification is
fitted, a type of hidden Markov model.  <code>E</code> should then be a
matrix indicating the structure of allowed misclassifications,
where rows are the true states, and columns are the observed
states.  A zero entry in row \(r\) and column \(s\) indicates
that true state \(r\) cannot be observed as state
\(s\).  A non-zero \((r,s)\) entry indicates that true state
\(r\) may be misclassified as \(s\). The diagonal of <code>E</code>
is ignored.</p></dd>


<dt id="arg-priors">priors<a class="anchor" aria-label="anchor" href="#arg-priors"></a></dt>
<dd><p>A list specifying priors.  Each component should be
the result of a call to <code><a href="msmprior.html">msmprior</a></code>.  Any parameters
with priors not specified here are given default priors: normal
with mean -2 and SD 2 for log intensities, normal with mean
0 and SD 10 for log hazard ratios, normal(0,1) for log odds parameters
in misclassification models.</p>
<p>In phase-type approximation models, the default priors are normal
with mean 2, SD 2 for scale parameters (i.e. the log inverse of the
default prior for the rate), normal(0, SD=0.5) truncated on the
supported region for log shape parameters, and normal(0,1) for log
odds of transition (relative to first exit state) in structures
with competing exit states.</p>
<p>See <code><a href="msmprior.html">msmprior</a></code> for more details.</p>
<p>If only one parameter is given a non-default prior, a single <code>msmprior</code>
call can be supplied here instead of a list.</p>
<p>Maximum likelihood estimation can be performed by setting
<code>priors="mle"</code>, and using <code>fit_method="optimize"</code>.  This is
equivalent to estimating the posterior mode with improper uniform
priors on the unconstrained parameter space (i.e. positive
parameters on the log scale).  Uncertainty is then quantified by
sampling from the multivariate normal defined by the Hessian at the
mode .  The sample can be summarised to produce confidence
intervals, as in the <code>ci="normal"</code> method in the <code>msm</code> package.
These are equivalent to credible intervals from a Laplace
approximation to the posterior.</p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>Number of samples to generate</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with one column per model parameter (on a transformed scale, e.g. log intensities), and one row per sample.    The names are in the natural
format as specified in <code>priors</code>.</p>
<p>An attribute <code>"stan_names"</code> contains the names of the
corresponding parameters in the <code>draws</code> object that would be
returned by <code>msmbayes</code> if this model were to be fitted to data.
These are the names used internally by Stan, and not meant to be
interpretable by users.</p>
<p>An attribute <code>"expand"</code> contains the same sample but with
parameters for covariate effects referring to state transitions
on the latent space.  Used internally for posterior predictive
sampling.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

